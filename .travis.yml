# Build script for Travis CI
#

# use fast-boot container-based hosts
sudo: false 
dist: trusty

# no need to check for oracle's java
language: java
jdk: openjdk8

# speed up builds by caching maven local repository
cache:
  directories:
  - "$HOME/.m2/repository"

# as agreed in our SOP
branches:
  only:
  - master
  - development

# added to make logs look cleaner, crisper, certified fresh
before_install: unset _JAVA_OPTIONS 

# speed up builds by telling Travis that we don't need any special "installation"
install: true

# as agreed in our SOP, build everything (don't deploy, just try to 'mvn install' locally, which covers all phases)
script: mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml clean cobertura:cobertura install
# upload code coverage report, generate maven site (javadocs, documentation, static code analysis, etc.)
after_success: 
- bash <(curl -s https://codecov.io/bash)
- mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml site

# upload to maven
deploy:
  # as agreed in our SOP, builds on development branch will deploy to our maven repository after validating
  # the artifact has a proper SNAPSHOT version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles development-build,!release-build --settings .travis.settings.xml deploy
  on:
    branch: development
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'
  # as agreed in our SOP, tagging a commit on the master branch will upload to our maven repository
  # after validating the artifact has a proper release version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles !development-build,release-build --settings .travis.settings.xml deploy
  on:
    branch: master
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'

# change according to your needs, but we recommend to deactivate email notifications
# for now, we configured Travis to send a notification to the #travis-ci channel 
notifications:
  email:
    on_success: never
    on_failure: never
  slack: 
    on_success: never
    on_failure: always
    # edit the following section if you want to get slack notifications
    rooms:
      - secure: "***"

# encrypted variables
env:
  global:
    - secure: "f0IFHFN5MgeQnnJEvh2WvGphQtmEYMX4fHb3Tzte9RU/909xN6MaAjo5D0ZZ2vCPlE9S18viytBwtCKWXi1ATID7rClHdveY8I+ZaAS9v3/7H44gzYc/SDVabOBBnW7gp63I0GWkrPIkGPuLva1fWLXfEeZY6QDi+CyA7jg8+UdtbseVNnzg0nM5g78HJ4bzeP/OMbnvnokl1yb++2OMl/htLLVH7JBv4EZxQOlVu+xyer9lagh9yLgd+gx4h4cNmDC9qrSxxBkhq0y4zf/ADliL2m0/M8Utrwg5xYumN69SP3TtcDiYXBTNc7ve/QwV9HGZdy8x9emwdfcVCLPTnGxJdCbuoPRJvvuhO+Nu97KOZs7inOuzPO393eSSqkePD983mPWoI4jv5j16SugVs48pQQ84XM3O0alwdHejOaIZy87Ru6hOER4y2QUyaaXGTYtd/O+aR3zgyDBipI1jVaI7kp826hH66IGN9ab4jOJr23qWi9IYQ+79epnIs6UIblHuhK83VN8Oc9yWZvDRfIizVlqAVdMMwHMVhIiRbNKImNF02k7LmiSAi2e4MuQI+slucpfHwzTcwKOlWaNW0cbh/Yhu4hhpXWitQtmz1921coWfOY85r4klfIV5Vkr90pvtXwKkMhyyTi+0tjvK9Ho2UZc5X5HDXPM+soGMvfI="
    - secure: "JUTqElHR66Cu/egFIWBq/IX9YPCR38JQZTtjVtu7QBN5GYhIGcNVB+zdOkW1/AxmOSU8lofpdiJBz6CAYmeUtYsKD2zOeUpTPLnCxT2snthyrqRS1bLUuANtlS9mo7b/9ul3i3S4/ohW4bC0QyvpzIdwQtwltnxft7C/3D2xADGMWfFWh38NVxYW1hSPNh2/VR0NvCFfwAeDgtiuWD3LZkVVCVG8N+9Z8H3Os21KLGJv4Azcfd0SF4lxQkMRVsbQSUiwzy5zas2KStYYGx2znqRaRQjxlE3w7hHyilWFzMaL2AafbnJKStuWIV4bkH2+/B0L+xMVggimMJjxhzWy0VMSpObFwVOGvW80NdApGaAvtvowmUhcETVs6cupZRLJPGr406SWCtFjnGobr9U8xe6d9dOS0S6zVaqkjVG3MGrRuVAlAUZcvkHLjc834DoqOWT5t+GJisf/auGwNAh0emH2q3vsLU1DrNERJsoj/kMmx/Nu53Gqns9BcQky6ORcQKzBkc1EsPQu1IQPnN2q8u5OLDAeyf/I55Ue3px/287to0otVwnnmOs8X73VqMUZByio5JRyNjlA4F3VsisOQYHf+GmgVapYCtP9qvrN4+tFNFqpqh7y8Q7uBg95nF8BAFsgNZJOtGIRa53PZi9xb7Rb4OQfIb+rV73LGR6Jrd0="
